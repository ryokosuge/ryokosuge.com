---
description: 現在のClaude Code会話をブログ記事として自動保存するコマンド
---

この会話をブログ記事として保存します。すべて自動で処理されます！

全て日本語で対応してください。

あなたは会話ログを自動生成するAIアシスタントです。以下の手順で会話ログを作成してください：

## 重要な注意事項

- **ユーザーとの対話は一切不要です** - 全自動で処理してください
- 確認や質問をせず、すべて自動判断で進めてください
- エラーが発生した場合のみユーザーに通知してください

## 実行手順

### 1. 会話履歴の取得と分析

現在のセッション全体（このコマンドが実行されるまでのすべてのやりとり）を対象に、以下を**自動生成**してください：

#### a) タイトル生成（必須）
- この会話の主題を1文で表現（30-60文字が目安）
- 具体的で内容が伝わるタイトルにする
- 例: 「TypeScriptの型システムとジェネリクスについて」
- **フォールバック**: 生成失敗時は「Conversation YYYY-MM-DD」

#### b) 要約生成（必須）
- 会話の重要ポイントを2-3文で要約（100-200文字が目安）
- 何について話し、何を学んだか、何を決めたかを明確に
- 例: 「TypeScriptの型システムの基本とジェネリクスの使い方について議論。型安全性とコードの再利用性を向上させる方法を学んだ。」
- **フォールバック**: 生成失敗時は「会話の記録」

#### c) タグ生成（必須）
- 会話から3-5個の重要キーワードを抽出
- 優先度順（最も重要なものから）
- 例: `[TypeScript, 型システム, ジェネリクス, プログラミング]`
- **フォールバック**: 生成失敗時は空配列 `[]`

### 2. ランダムID生成

以下のコマンドを実行してファイル名用のIDを生成：

```bash
openssl rand -base64 24 | tr -dc 'a-zA-Z0-9' | head -c 32
```

### 3. 会話内容の整形

会話全体を以下の形式で時系列に整形してください：

```markdown
## 会話ログ

### YYYY-MM-DD HH:MM:SS

**User**: （ユーザーのメッセージ）

**Claude**: （Claudeのレスポンス）

### YYYY-MM-DD HH:MM:SS

**User**: （次のユーザーメッセージ）

**Claude**: （次のClaudeレスポンス）

（会話が続く...）
```

**重要な処理**:
- コードブロックは ` ```言語名 ` で適切にエスケープ
- Markdown特殊文字（`*`, `_`, `[`, `]`など）を適切にエスケープ
- タイムスタンプは実際の会話時刻を使用（取得できない場合は推定時刻）
- メッセージは完全に保持（省略しない）

### 4. Markdownファイル生成

生成したIDを使って `content/conversations/[ID].md` を作成し、以下の構造で保存：

```markdown
---
date: （現在時刻 ISO 8601形式: YYYY-MM-DDTHH:MM:SS+09:00 ※必ず現在時刻を使用すること。未来の日付はHugoがビルドしません）
draft: false
title: "（生成したタイトル）"
description: "（生成した要約）"
tags:
  - （タグ1）
  - （タグ2）
  - （タグ3）
---

（整形した会話ログ全体）
```

**ファイルパス**: `content/conversations/[32文字ID].md`

### 5. 完了メッセージ表示

ファイル作成後、以下の形式でユーザーに通知：

```
✅ 会話を保存しました！

ファイル: content/conversations/[ID].md
タイトル: （生成したタイトル）
タグ: （タグ1, タグ2, タグ3, ...）

ローカルでプレビュー: make server
```

## エラーハンドリング

- **会話が空の場合**: 「エラー: 保存する会話がありません。少なくとも1つのメッセージペアが必要です」と表示して終了
- **ID生成失敗**: リトライ、それでも失敗なら日時ベースのIDを使用（例: `conv_20251114_103000`）
- **ファイル書き込み失敗**: エラーメッセージを表示し、ユーザーに権限確認を依頼

## 実装のポイント

1. **完全自動化**: ユーザーとの対話なしで完結
2. **AI分析**: Claude自身が会話を分析してメタデータ生成
3. **エラー耐性**: フォールバック値で処理続行
4. **品質重視**: タイトル・要約は読みやすく、タグは的確に
5. **即座実行**: このコマンドが呼ばれたらすぐに実行開始

## 注意事項

- このコマンドは `/save-conversation` として実行されます
- 同じ会話で複数回実行すると、異なるIDで複数ファイルが作成されます
- 生成されたファイルは手動編集を想定していません
- ファイル作成後、`hugo server -D` でローカルプレビュー可能です
